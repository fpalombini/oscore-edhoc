<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Implementing EDHOC and OSCORE</title>
<meta content="Francesca Palombini" name="author">
<meta content="
       TODO Abstract 
    " name="description">
<meta content="xml2rfc 2.39.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-palombini-core-oscore-edhoc-latest" name="ietf.draft">
<link href="draft-palombini-core-oscore-edhoc.xml" type="application/rfc+xml" rel="alternate">
<link href="#copyright" rel="license">
<style type="text/css">@import url('https://martinthomson.github.io/i-d-template/fonts.css');

html {
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --small-font-size: 14.5px;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
#title {
  padding: 1em 0 0.2em;
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1, h2, h3 {
  font-size: 22px;
  line-height: 26px;
}
h4, h5, h6 {
  font-size: 18px;
  line-height: 22px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p, #abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 18px;
  line-height: 24px;
}
p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
dd.break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px 'Oxygen Mono', monospace;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre {
    display: inline-block;
    overflow-x: auto;
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
  table {
    display: inline-block;
    overflow-x: auto;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  text-align: left;
  background-color: #eee;
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  margin: 0;
  padding: 3px 1em;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  visibility: hidden;
  user-select: none;
}
a.pilcrow[href] { color: #ddd; }
a.pilcrow[href]:hover { text-decoration: none; }
@media screen {
  :hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 500px) {
  .index ul {
    column-count: 2;
    column-gap: 20px;
  }
  .index ul ul {
    column-count: 1;
    column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table .text-left, table .text-left {
  text-align: left;
}
table .text-center, table .text-center {
  text-align: center;
}
table .text-right, table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
</style>
<link href="rfc-local.css" type="text/css" rel="stylesheet">
</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">EDHOC + OSCORE</td>
<td class="right">July 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Palombini</td>
<td class="center">Expires 4 January 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">CoRE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-palombini-core-oscore-edhoc-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-07-03" class="published">3 July 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-01-04">4 January 2021</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">F. Palombini</div>
<div class="org">Ericsson</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Implementing EDHOC and OSCORE</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">TODO Abstract<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 4 January 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terminology" class="xref">Terminology</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-background" class="xref">Background</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-edhoc-in-oscore-protected-c" class="xref">EDHOC in OSCORE Protected CoAP</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-signalling-in-a-new-edhoc-o" class="xref">Signalling in a New EDHOC Option</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-signalling-in-the-oscore-op" class="xref">Signalling in the OSCORE Option</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-oscore-request-in-a-coap-me" class="xref">OSCORE Request in a COAP message</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-signalling-in-a-new-edhoc-op" class="xref">Signalling in a New EDHOC Option</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-predetermined" class="xref">Predetermined</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-appendix.b" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
</ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document presents possible options to combine the EDHOC protocol <span>[<a href="#I-D.selander-lake-edhoc" class="xref">I-D.selander-lake-edhoc</a>]</span>, run over CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>, with the first subsequent OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> transaction.
This allows to minimize the number of roundtrips necessary to setup the OSCORE security material.
The goal of this specification is to gather opinions on each option, and develop only one of these options.<a href="#section-1-1" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">The reader is expected to be familiar with terms and concepts of <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>, <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> and <span>[<a href="#I-D.selander-lake-edhoc" class="xref">I-D.selander-lake-edhoc</a>]</span>.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="background">
<section id="section-2">
      <h2 id="name-background">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-background" class="section-name selfRef">Background</a>
      </h2>
<p id="section-2-1">EDHOC is a 3 message key exchange protocol.
Section 7.1 of <span>[<a href="#I-D.selander-lake-edhoc" class="xref">I-D.selander-lake-edhoc</a>]</span> specifes how to transport EDHOC over CoAP: the EDHOC data (referred to as "EDHOC messages") are transported in the payload of CoAP requests and responses.
More specifically, the Initiator, acting as CoAP Client, sends a POST request to a reserved resource at the Responder, acting as CoAP Server.
This triggers the EDHOC exchange on the CoAP Server, which replies with 2.04 (Changed) Response containing EDHOC message 2.
The EDHOC message 3 is also sent by the CoAP Client in a CoAP POST request to the same resource used for EDHOC message 1.
The Content-Format of these CoAP messages is set to "application/edhoc".<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">After this exchange takes place, and after successful verifications specified in the EDHOC protocol, Client and Server derive the OSCORE Security Context, as specified in Section 7.1.1 of <span>[<a href="#I-D.selander-lake-edhoc" class="xref">I-D.selander-lake-edhoc</a>]</span>.
They are then ready to use OSCORE.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">This sequential way of running EDHOC and then OSCORE is specified in <a href="#fig-non-combined" class="xref">Figure 1</a>.
As shown, this mechanism is executed in 3 roundtrips.<a href="#section-2-3" class="pilcrow">¶</a></p>
<span id="name-edhoc-and-oscore-run-sequen"></span><div id="fig-non-combined">
<figure id="figure-1">
        <div class="artwork art-text alignCenter" id="section-2-4.1">
<pre>
   CoAP Client                                  CoAP Server
        | ------------- EDHOC message_1 ------------&gt; |
        |                                             |
        | &lt;------------ EDHOC message_2 ------------- |
        |                                             |
EDHOC verification                                    |      
        |                                             |
        | ------------- EDHOC message_3 ------------&gt; | 
        |                                             |
        |                                    EDHOC verification
        |                                             |
OSCORE Sec Ctx                                OSCORE Sec Ctx
  Derivation                                    Derivation 
        |                                             |
        | -------------- OSCORE Request ------------&gt; |
        |                                             |
        | &lt;------------ OSCORE Response ------------- |
        |                                             |
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-edhoc-and-oscore-run-sequen" class="selfRef">EDHOC and OSCORE run sequentially</a>
        </figcaption></figure>
</div>
<p id="section-2-5">The number of roundtrips can be minimized: after receiving EDHOC message 2, the CoAP Client has all the information needed to derive the OSCORE Sec Ctx before sending EDHOC message 3. 
That means that it can potentially send at the same time both EDHOC message 3 and the subsequent OSCORE Request.
On a semantyc level, this approach requires in practice to send two separate 
REST requests at the same time.
Defining the specific details of how to transport the data and order of processing is the goal of this specification.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6">The high level message flow of running EDHOC and OSCORE combined is shown in <a href="#fig-combined" class="xref">Figure 2</a>.<a href="#section-2-6" class="pilcrow">¶</a></p>
<span id="name-edhoc-and-oscore-combined"></span><div id="fig-combined">
<figure id="figure-2">
        <div class="artwork art-text alignCenter" id="section-2-7.1">
<pre>
   CoAP Client                                  CoAP Server
        | ------------- EDHOC message_1 ------------&gt; |
        |                                             |
        | &lt;------------ EDHOC message_2 ------------- |
        |                                             |
EDHOC verification +                                  |
  OSCORE Sec Ctx                                      |
    Derivation                                        |
        |                                             |
        | ------------- EDHOC message_3 ------------&gt; |
        |              + OSCORE Request               | 
        |                                             |
        |                                  EDHOC verification +
        |                                     OSCORE Sec Ctx
        |                                        Derivation 
        |                                             |
        | &lt;------------ OSCORE Response ------------- |
        |                                             |
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-edhoc-and-oscore-combined" class="selfRef">EDHOC and OSCORE combined</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="edhoc-in-oscore">
<section id="section-3">
      <h2 id="name-edhoc-in-oscore-protected-c">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-edhoc-in-oscore-protected-c" class="section-name selfRef">EDHOC in OSCORE Protected CoAP</a>
      </h2>
<p id="section-3-1">The first possibility is to send the EDHOC message 3 inside an OSCORE protected CoAP message.
The request is in practice the OSCORE CoAP Request from <a href="#fig-non-combined" class="xref">Figure 1</a>, sent to the protected resource andpoint and with correct CoAP method and options, with the addition that it also transports EDHOC message 3.
As EDHOC message 3 is too large for being contained in a CoAP Option, it would have to be transported in the CoAP payload.
The payload is formatted as a CBOR sequence of two CBOR wrapped items: the EDHOC message 3 and the OSCORE ciphertext, in this order.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">When receiving such a request, the Server needs to execute the following processing, additional to EDHOC, OSCORE and CoAP processing:<a href="#section-3-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3-3">
        <li id="section-3-3.1">Parse the signalling option to identify that this is an OSCORE + EDHOC request (more in <a href="#sign-1" class="xref">Section 3.1</a> and <a href="#sign-2" class="xref">Section 3.2</a>).<a href="#section-3-3.1" class="pilcrow">¶</a>
</li>
<li id="section-3-3.2">Extract the EDHOC message 3 from the payload.<a href="#section-3-3.2" class="pilcrow">¶</a>
</li>
<li id="section-3-3.3">Execute the EDHOC processing, including verifications and OSCORE Security Context derivation.<a href="#section-3-3.3" class="pilcrow">¶</a>
</li>
<li id="section-3-3.4">Decrypt and verify the remaining OSCORE protected CoAP request as defined by OSCORE.<a href="#section-3-3.4" class="pilcrow">¶</a>
</li>
<li id="section-3-3.5">Process the CoAP requests.<a href="#section-3-3.5" class="pilcrow">¶</a>
</li>
</ol>
<p id="section-3-4">The following sections describe 2 ways of signalling that the EDHOC message is transported in the OSCORE message. In a next update of these document, we will<a href="#section-3-4" class="pilcrow">¶</a></p>
<div id="sign-1">
<section id="section-3.1">
        <h3 id="name-signalling-in-a-new-edhoc-o">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-signalling-in-a-new-edhoc-o" class="section-name selfRef">Signalling in a New EDHOC Option</a>
        </h3>
<p id="section-3.1-1">One way to signal that the Server is to extract and process EDHOC message 3 before the OSCORE message is processed is to define a new CoAP Option, called the EDHOC Option.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">This Option being present (either in a request or response) means the payload contains EDHOC data in the payload, that must be extracted and processed before the rest of the message can be executed.
The EDHOC message is to be extracted from the CoAP payload as the CBOR wrapped first element of a CBOR sequence.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">The Option is critical, Safe-to-Forward, and part of the Cache-Key.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4">The Option value is always empty. If any value is sent, the value is simply discarded.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1-5">The Option must occurr at most once.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">The Option is of Class U for OSCORE.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sign-2">
<section id="section-3.2">
        <h3 id="name-signalling-in-the-oscore-op">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-signalling-in-the-oscore-op" class="section-name selfRef">Signalling in the OSCORE Option</a>
        </h3>
<p id="section-3.2-1">Another way to signal that the EDHOC message is to be extracted from the CoAP payload as the CBOR wrapped first element of a CBOR sequence, and that the processing defined in <a href="#edhoc-in-oscore" class="xref">Section 3</a> is to be executed is to use one of the OSCORE Flag Bits.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">Bit Postion: 8<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">Name: EDHOC<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2-4">Description: Set to 1 if the payload is a sequence of EDHOC data and OSCORE payload.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5">Reference: this document<a href="#section-3.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="oscore-request-in-a-coap-message">
<section id="section-4">
      <h2 id="name-oscore-request-in-a-coap-me">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-oscore-request-in-a-coap-me" class="section-name selfRef">OSCORE Request in a COAP message</a>
      </h2>
<p id="section-4-1">Instead of transporting the EDHOC message inside an OSCORE message, the OSCORE protected data could be transported in a EDHOC message.
The request is in practice the CoAP POST Request containing EDHOC message 3 from <a href="#fig-non-combined" class="xref">Figure 1</a>, sent to the unprotected resource andpoint reserved to EDHOC processing, with the addition that it also transports the OSCORE Option and Ciphertext.
The OSCORE Option and ciphertext contain all the information to reconstruct the original OSCORE Request, including CoAP method, options and payload.
Both OSCORE Option, EDHOC message_3 and ciphertext would have to be transported in the CoAP payload.
The payload is formatted as a CBOR sequence of three CBOR wrapped items: the EDHOC message 3, the OSCORE Option and the OSCORE ciphertext, in this order.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">When receiving such a request, the Server needs to execute the following processing, additional to EDHOC, OSCORE and CoAP processing:<a href="#section-4-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-4-3">
        <li id="section-4-3.1">Parse the signalling option to identify that this is an EDHOC + OSCORE request (more in <a href="#sign-3" class="xref">Section 4.1</a> and <a href="#sign-4" class="xref">Section 4.2</a>).<a href="#section-4-3.1" class="pilcrow">¶</a>
</li>
<li id="section-4-3.2">Extract the EDHOC message 3 from the payload.<a href="#section-4-3.2" class="pilcrow">¶</a>
</li>
<li id="section-4-3.3">Execute the EDHOC processing, including verifications and OSCORE Security Context derivation.<a href="#section-4-3.3" class="pilcrow">¶</a>
</li>
<li id="section-4-3.4">Extract the OSCORE Option value and ciphertext from the payload and reconstruct the OSCORE protected CoAP request.<a href="#section-4-3.4" class="pilcrow">¶</a>
</li>
<li id="section-4-3.5">Decrypt and verify the reconstructed OSCORE protected CoAP request as defined by OSCORE.<a href="#section-4-3.5" class="pilcrow">¶</a>
</li>
<li id="section-4-3.6">Process the CoAP requests.<a href="#section-4-3.6" class="pilcrow">¶</a>
</li>
</ol>
<p id="section-4-4">This processing requires one more step, as the server must build the protected request from the payload before being able to process it.<a href="#section-4-4" class="pilcrow">¶</a></p>
<div id="sign-3">
<section id="section-4.1">
        <h3 id="name-signalling-in-a-new-edhoc-op">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-signalling-in-a-new-edhoc-op" class="section-name selfRef">Signalling in a New EDHOC Option</a>
        </h3>
<p id="section-4.1-1">One way to signal that the Server is to build and process the OSCORE request after EDHOC processing is to define a new CoAP Option, called the EDHOC Option.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">This Option being present (either in a request or response) means the payload contains OSCORE option value and ciphertext in the payload, that must be extracted and processed after the EDHOC processing.
The OSCORE option and ciphertext are to be extracted from the CoAP payload as the CBOR wrapped second and third element of a CBOR sequence.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">The Option is critical, Safe-to-Forward, and part of the Cache-Key.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">The Option value is always empty. If any value is sent, the value is simply discarded.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">The Option must occurr at most once.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6">The Option is of Class U for OSCORE.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sign-4">
<section id="section-4.2">
        <h3 id="name-predetermined">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-predetermined" class="section-name selfRef">Predetermined</a>
        </h3>
<p id="section-4.2-1">Another way to support the combined mode and to mandate that the Server is to build and process the OSCORE request after EDHOC processing is to set up pre-determined policies in place in both the Client and Server.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">A Client may be set up to support at the same time receiving only EDHOC message 3 or both EDHOC message 3 and OSCORE Option and ciphertext in the request.
The Client would be able to distinguish based on the number of CBOR elements in the payload, and process the message accordingly.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-5-1">TODO Security<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">This document has no IANA actions.<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-7">
      <h2 id="name-normative-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="I-D.ietf-cbor-7049bis">[I-D.ietf-cbor-7049bis]</dt>
<dd>
<span class="refAuthor">Bormann, C.</span><span class="refAuthor"> and P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cbor-7049bis-14</span>, <time datetime="2020-06-16">16 June 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-cbor-7049bis-14.txt">http://www.ietf.org/internet-drafts/draft-ietf-cbor-7049bis-14.txt</a>&gt;</span>. </dd>
<dt id="I-D.selander-lake-edhoc">[I-D.selander-lake-edhoc]</dt>
<dd>
<span class="refAuthor">Selander, G.</span><span class="refAuthor">, Mattsson, J.</span><span class="refAuthor">, and F. Palombini</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-selander-lake-edhoc-01</span>, <time datetime="2020-03-09">9 March 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-selander-lake-edhoc-01.txt">http://www.ietf.org/internet-drafts/draft-selander-lake-edhoc-01.txt</a>&gt;</span>. </dd>
<dt id="RFC2119">[RFC2119]</dt>
<dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dt id="RFC7252">[RFC7252]</dt>
<dd>
<span class="refAuthor">Shelby, Z.</span><span class="refAuthor">, Hartke, K.</span><span class="refAuthor">, and C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dt id="RFC8174">[RFC8174]</dt>
<dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dt id="RFC8613">[RFC8613]</dt>
<dd>
<span class="refAuthor">Selander, G.</span><span class="refAuthor">, Mattsson, J.</span><span class="refAuthor">, Palombini, F.</span><span class="refAuthor">, and L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8613">https://www.rfc-editor.org/info/rfc8613</a>&gt;</span>. </dd>
</dl>
</section>
<div id="acknowledgments">
<section id="section-appendix.a">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-appendix.a-1">Jim Schaad, Malisa Vucinic, Klaus Hartke, Christian Amsuess<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.b">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Francesca Palombini</span></div>
<div dir="auto" class="left"><span class="org">Ericsson</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:francesca.palombini@ericsson.com" class="email">francesca.palombini@ericsson.com</a>
</div>
</address>
</section>
</div>
<script>var toc = document.getElementById("toc");
var tocToggle = toc.querySelector("h2");
var tocNav = toc.querySelector("nav");

// mobile menu toggle
tocToggle.onclick = function(event) {
    if (window.innerWidth < 1024) {
 var tocNavDisplay = tocNav.currentStyle ? tocNav.currentStyle.display : getComputedStyle(tocNav, null).display;
 if (tocNavDisplay == "none") {
     tocNav.style.display = "block";
 } else {
     tocNav.style.display = "none";
 }
    }
}

// toc anchor scroll to anchor
tocNav.addEventListener("click", function (event) {
    event.preventDefault();
    if (event.target.nodeName == 'A') {
 if (window.innerWidth < 1024) {
     tocNav.style.display = "none";
 }
 var href = event.target.getAttribute("href");
 var anchorId = href.substr(1);
 var anchor =  document.getElementById(anchorId);
 anchor.scrollIntoView(true);
 window.history.pushState("","",href);
    }
});

// switch toc mode when window resized
window.onresize = function () {
    if (window.innerWidth < 1024) {
 tocNav.style.display = "none";
    } else {
 tocNav.style.display = "block";
    }
}
</script>
</body>
</html>
